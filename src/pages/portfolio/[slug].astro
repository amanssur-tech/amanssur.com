---
export const prerender = false;
import BaseLayout from '../../layouts/BaseLayout.astro';
import { resolveLang } from '../../lib/lang';
import type { Lang } from '../../lib/i18n';
import { translations } from '../../lib/i18n';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404', 404);
}

const project = projects.find((entry) => entry.data.slug === slug || entry.slug === slug);

if (!project || !project.data.published) {
  return Astro.redirect('/404', 404);
}

const lang =
  ((Astro.locals as Record<string, unknown>).lang as Lang | undefined) ??
  resolveLang({ cookies: Astro.cookies, acceptLanguage: Astro.request.headers.get('accept-language') });

const localizedTitle = lang === 'de' ? project.data.title_de : project.data.title_en;
const localizedDescription = lang === 'de' ? project.data.description_de : project.data.description_en;
const workMeta = translations[lang].work;
const metaTitle = `${localizedTitle} | ${workMeta.metaTitle}`;
---
<BaseLayout
  lang={lang}
  page="workdetail"
  projectEntry={project}
  metaTitle={metaTitle}
  metaDescription={localizedDescription}
  ogImage={project.data.heroImage}
/>
